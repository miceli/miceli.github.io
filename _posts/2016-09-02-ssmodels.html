<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="date" content="2016-09-02" />

<title>Cointegração e Fator Comum em Estado Espaço</title>




<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0A%7D%0Apre%20%7B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Cointegração e Fator Comum em Estado Espaço</h1>
<h4 class="date"><em>2016-09-02</em></h4>
</div>


<div id="introducao" class="section level2">
<h2>Introdução</h2>
<p>A nota mostra o caso específico de um modelo bivariado com uma tendência estocastica em comum em formato de state-space. O modelo é encontrado diretamente em <span class="citation">(Harvey 1989)</span> capítulo 8. A aplicação do modelo será em séries temporais de ações negociadas na bovespa. A relação de cointegração será explicitada, podendo assim comparar diretamente com modelos VAR/VECM estimados por maxima verossimilhança.</p>
<p>Um breve comentário sobre os pacotes em <strong>R</strong> para a implementação do modelo será feito. A ideia é mostrar, de forma parcial, um grande número de opções para a implementação e listar basicamente as formulações dos diversos pacotes. Após a descrição dos pacotes, os modelos serão escritos na formulação particular de cada respectivo pacote. Esse trabalho consite em escrever as matrizes das equações do vetor de estado e observação de forma coerênte com a formulação da rotina.</p>
<p>O cometário final será sobre uma posivel extenção do modelo linear para uma forma não-linear (bi-linear).</p>
</div>
<div id="tendencia-estocastica-comum-em-modelo-em-state-space" class="section level2">
<h2>Tendência estocastica comum em modelo em state-space</h2>
<p>Seguindo <span class="citation">(Harvey 1989)</span>, o modelo genérico de interesse é:</p>
<ol style="list-style-type: decimal">
<li><span class="math display">\[ 
\begin{align}
y_t &amp;= \Theta \mu_t + \mu_{0} + \epsilon_t  &amp; \text{Var$(\epsilon_t) = \Sigma_{\epsilon}$,} &amp; \text{equação de observação} \\
\mu_t &amp;= \mu_{t-1} + \beta + \eta_{t} &amp; \text{Var$(\eta_t) = \Sigma_{\eta}$,} &amp; \text{equação de transição de estado.}
\end{align}
\]</span> Onde <span class="math inline">\(\mu_t\)</span> é um vetor <span class="math inline">\(K \times 1\)</span> de representando a tedência comum, <span class="math inline">\(\Theta\)</span> é uma matriz <span class="math inline">\(N \times K\)</span> dos coeficientes dos fatores (factor loadings) e <span class="math inline">\(0 \leq K \leq N\)</span>. As observações <span class="math inline">\(y_{t}\)</span> é um vetor de dimensão <span class="math inline">\(N\)</span>. As matrizes de covariancia <span class="math inline">\(\Sigma_{\epsilon}\)</span> e <span class="math inline">\(\Sigma_{\eta}\)</span> tem dimensão <span class="math inline">\(N \times N\)</span> e <span class="math inline">\(K \times K\)</span>, respectivamente. O vetor <span class="math inline">\(\mu_{0}\)</span> é da forma:</li>
</ol>
<p><span class="math display">\[
\mu_0 = \left[ \begin{array}{c}
0 \\
\bar{\mu}
\end{array}
\right]
\]</span></p>
<p>O vetor <span class="math inline">\(0\)</span> em <span class="math inline">\(\mu_0\)</span> tem dimensão <span class="math inline">\(K\)</span> e <span class="math inline">\(\bar{\mu}\)</span> é um vetor de dimensão <span class="math inline">\(N-K\)</span> sem restrição alguma sobre seus valores.</p>
<p>As séries <span class="math inline">\(\eta_t\)</span> e <span class="math inline">\(\epsilon_t\)</span> são ruidos brancos (multivariado) e não correlacionado entre sim. O importante é que <span class="math inline">\(\eta_t\)</span> e <span class="math inline">\(\epsilon_t\)</span> sejam estacionárias, estruturas de correlação entre as séries podem ser incorpoaradas como em <span class="citation">(Koopman, Shephard, and Doornik 1999)</span>.</p>
</div>
<div id="identificacao" class="section level2">
<h2>Identificação</h2>
<p>Apesar do sistema descrito pelas equações em (1.) já está descrito na forma state-space a sua estimativa não é possivel de ser feita devido ao problema de identificação. Para qualquer matriz não-singular <span class="math inline">\(H\)</span> <span class="math inline">\(K \times K\)</span>, podemos redefinir os coeficientes dos fatores <span class="math inline">\(\Theta\)</span> e a variavel de estado <span class="math inline">\(\mu_t\)</span> de forma ainda manter a mesma séries observacional, desta forma a mesma distribuição de <span class="math inline">\(y_t\)</span> pode ser obitida com diferentes configurações de parâmetros e estado. Para isso, basta fazer <span class="math inline">\(\Theta^{\dagger} = \Theta H^{-1}\)</span> e <span class="math inline">\(\mu_{t}^{\dagger} = H \mu_t\)</span>, logo</p>
<ol start="2" style="list-style-type: decimal">
<li><span class="math display">\[ 
\begin{align}
y_t &amp;= \Theta^{\dagger} \mu_{t}^{\dagger} + \mu_{0} + \epsilon_t  \\
\mu_{t}^{\dagger} &amp;= \mu_{t-1}^{\dagger} + \beta^{\dagger} + \eta_{t}^{\dagger}
\end{align}
\]</span></li>
</ol>
<p>Onde <span class="math inline">\(\mu_{t}^{\dagger} = H \eta_t\)</span>, <span class="math inline">\(\beta^{\dagger} = H \beta\)</span> e <span class="math inline">\(\text{Var$(\eta_{t}^{\dagger}) = H \Sigma_{\eta} H^{'}$}\)</span>. Ou seja (1.) é indistinguível de (2.).</p>
<p>A identificação é obtida colocando restrições em <span class="math inline">\(\Sigma_{\eta}\)</span> e em <span class="math inline">\(\Theta\)</span>. Em abordagem classíca de análise de fatores a matriz de covariância dos fatores é fixa como a matriz identidade, mas outras restrições podem ser feitas. Até mesmo porque, somente com essa restrição não é suficiente para obter a identificação. Alguma restrição deve ser feita em <span class="math inline">\(\Theta\)</span>. A restrição adotada, também suguerida em <span class="citation">(Harvey 1989)</span> é:</p>
<ul>
<li><span class="math inline">\(\Sigma_{\eta}\)</span> uma matriz diagonal positiva definida.</li>
<li><span class="math inline">\(\Theta_{ij} = 0 \text{  para $j &gt; i$}\)</span> e <span class="math inline">\(\Theta_{ii} = 1 \text{para $i = 1, \dots, K$.}\)</span></li>
</ul>
<p>Essas restrições de identificação implicam que as tendências estocasticas comuns são não correlacionadas. No caso de um modelo bi-dimensional com apenas uma tendência estocastica isso não gera restrição alguma na evolução desta tendência.</p>
</div>
<div id="cointegracao" class="section level2">
<h2>Cointegração</h2>
<p>O modelo de tendência estocastica comum tem a propiedade de que <span class="math inline">\(N-K\)</span> combinação lineares da série <span class="math inline">\(y_t\)</span> são estacionárias (fracamente) mesmo que as sériee em <span class="math inline">\(y_t\)</span> tenham raiz unitária e seja estacionárias, individualmente, mediante a operação de primeira diferença. Ou seja, a série <span class="math inline">\(y_t\)</span> pode ser cointegrada de ordem (1,1) (veja <span class="citation">(Harvey 1989)</span> e <span class="citation">(Lutkepohl 2005)</span>).</p>
<p>No caso de cointegração, existe uma matriz (tranformação linear) <span class="math inline">\(A\)</span> de ordem <span class="math inline">\((N-K) \times N\)</span> tal que</p>
<ol start="3" style="list-style-type: decimal">
<li><span class="math display">\[ A \Theta = 0.\]</span></li>
</ol>
<p>Logo pre-multiplicando <span class="math inline">\(A\)</span> na equação de obervação <span class="math display">\[ Ay_t = A \mu_0 + A \epsilon_t\]</span></p>
<p>ficando evidente que <span class="math inline">\(y_t\)</span> tem distribuição estacionária com média <span class="math inline">\(A \mu_0\)</span> e variância <span class="math inline">\(A\Sigma_{\epsilon}A^{'}\)</span>.</p>
</div>
<div id="o-caso-bivariado-particular" class="section level2">
<h2>O caso bivariado particular</h2>
<p>O interesse é no caso de modelar duas série de preços de ações, ou seja, <span class="math inline">\(N= 2\)</span> e <span class="math inline">\(K = 1\)</span>. De forma explicita as equações em (1.) incorporando as restrições de indentificação mencionadas ficam:</p>
<ol start="4" style="list-style-type: decimal">
<li><span class="math display">\[
\begin{cases}
\left[
\begin{array}{c}
  y_{1t} \\
  y_{2t}
\end{array}
\right] = \left[ \begin{array}{c}
1 \\
\theta
\end{array}
\right] \mu_t +  \left[ \begin{array}{c}
0 \\
\bar{\mu}
\end{array}
\right] +  \left[ \begin{array}{c}
\epsilon_{1t} \\
\epsilon_{2t}
\end{array}
\right]  \\
\mu_{t} = \mu_{t-1} + \beta + \eta_t 
\end{cases}
\]</span></li>
</ol>
<p>Com <span class="math inline">\(\text{Var($\eta_t$) = $\sigma^{2}_{\eta}$}\)</span>. A matriz de cointegraçao <span class="math inline">\(A\)</span> tem dimensão <span class="math inline">\(1 \times 2\)</span> e é padronizada pelo primeiro elemento tornando <span class="math inline">\(A = [1, \alpha]\)</span>. A restrição <span class="math inline">\(A\Theta = 0\)</span> fica <span class="math display">\[ 1 + \alpha\theta = 0\]</span> <span class="math display">\[ \alpha = \frac{-1}{\theta}.\]</span></p>
<p>Multiplicando (4.) por <span class="math inline">\(A\)</span> temos:</p>
<p><span class="math display">\[ y_{1t} -\frac{1}{\theta}y_{2t} + \frac{\bar{\mu}}{\theta} = \epsilon_{t}\]</span></p>
<p>com <span class="math inline">\(\epsilon_t = \epsilon_{1t} - \epsilon_{2t}/\theta\)</span>.</p>
<p>Pela estacionarinade de <span class="math inline">\(\epsilon_t\)</span> ficou explicito o vetor de cointegração</p>
<ol start="5" style="list-style-type: decimal">
<li><span class="math display">\[
\left[ \begin{array}{r}
1, -\frac{1}{\theta}, \frac{\bar{\mu}}{\theta}
\end{array}
\right]. 
\]</span></li>
</ol>
<p>De forma mais sintética e usando (5.) podemos escrever <span class="math inline">\(y_{1t} + \tilde{\beta} y_{2t} + cte = \epsilon_t\)</span>.</p>
<p>Uma observação importante sobre a constantes <span class="math inline">\(\beta\)</span>, na equação de transição de estado, e <span class="math inline">\(\bar{\mu}\)</span> na equação de observação em (4.) deve ser feita. Na forma como especificado a série <span class="math inline">\(y_{1t}\)</span> possui além de uma tendência estocastica uma tendência linear no tempo. Essa propiedade não deve ser válida para séries de preços de ativos financeiros (apesar que esse é um problema que só pode ser respondido com testes estatísticos para casos particulares, o modelo de mercado eficiente tende a rejeitar essa propiedade como um fato usual). Ao contrário, séries macroeconomicas essa propiedade ocorre com mais frequencia e até mesmo ocorre que a tendência estocastica é eliminada ficando somente a tendência linear no tempo, alterando assim completamente as propiedades estatísticas da série. Já a constante <span class="math inline">\(\bar{\mu}\)</span> dificilmente poderia-se aceitar que essa constante tivesse o valor zero ou que poderia ser eliminada do vetor de cointegração. Porém, a natureza desta constante não altera a propiedades estatisticas das séries, tornando apenas uma padronização.</p>
<p>Ainda com relação a constante <span class="math inline">\(\beta\)</span>, o modelo com essa formulação pode ser extendido considerando que essa constante se tranforme em uma variavel de estado e passe a ter no modelo uma equação estocástica o qual o valor da série assim como sua volatilidade passam a ser estimados em conjunto com os demais parâmetros e variáveis.</p>
<p>Outro fato importante é que mesmo <span class="math inline">\(\beta\)</span> sendo diferente de zero este parâmetro não entra no vetor de cointegração.</p>
</div>
<div id="direcao-estocastica---stochastic-slope" class="section level2">
<h2>Direção estocástica - stochastic slope</h2>
<p>O modelo com direção estocastica bi-variado é alterado somente na equação de trasição de estado em (4). Neste caso o vetor de estado ganha mais uma dimensão. Para manter as condições de identificação deve-se restringir o variância deste novo componente, seguindo mais uma vez <span class="citation">(Harvey 1989)</span> colocando essa variância igual a 1. A equação de estado é dada por:</p>
<ol start="6" style="list-style-type: decimal">
<li><span class="math display">\[
\begin{align}
\mu_t &amp;= \mu_{t-1} + \Theta_{\beta}\beta_{t-1} + \eta_t  \\
\beta_t &amp;= \beta_{t-1} + \zeta_{t}
\end{align}
\]</span></li>
</ol>
<p>com <span class="math inline">\(\text{Var$(\zeta_t) = 1$}\)</span>.</p>
</div>
<div id="state-space-no-r" class="section level2">
<h2>State-space no <strong>R</strong></h2>
<p>Uma avaliação sobre a disponibilidade de pacotes em <strong>R</strong> para trabalhar com modelo de série temporal foi feita em <span class="citation">(Tusell 2011)</span>. A taxa de crescimento de pacotes em <strong>R</strong> continua muito alta, de forma que no <a href="https://cran.r-project.org/">CRAN</a> já há mais de 7 mil pacotes disponibilizados, fora os pacotes em <a href="https://www.bioconductor.org/">Bioconductor</a>, <a href="http://www.omegahat.org/">Omegahat</a> e os inúmeros pacotes não indexados em <a href="https://github.com/">Github</a>. Desta forma, até mesmo a procura por um método específico, como o presente caso de séries temporal em state-space, requer um esforço considerável para identificar todos os pacotes com a funcionalidade especificada. Neste sentido na lista feita em <span class="citation">(Tusell 2011)</span>, se fosse feita hoje, provavelmente não deixaria de mencionar o excelente <strong>MARSS</strong> (<span class="citation">(Holmes, Ward, and Wills 2013)</span> e <span class="citation">(Holmes, Ward, and Wills 2012)</span>).</p>
<p>Uma lista parcial de pacotes seria:</p>
<ol style="list-style-type: decimal">
<li><strong>cts</strong></li>
<li><strong>dlm</strong></li>
<li><strong>dse</strong></li>
<li><strong>FKF</strong></li>
<li><strong>KFAS</strong></li>
<li><strong>MARSS</strong></li>
<li><strong>sspir</strong></li>
<li><strong>Stem</strong></li>
<li><strong>StructTS</strong></li>
<li><strong>timsac</strong>.</li>
</ol>
<p>Um fator importante sobre os pacotes é a documentação. Nem todos possuem detalhes sobre o método estatístico usado na implementação e exemplos de uso. Exemplos de qualidade na documentação são os pacotes <strong>dlm</strong> (<span class="citation">(Petris 2010)</span> e <span class="citation">(Petris, Petrone, and Campagnoli 2009)</span>), <strong>MARSS</strong> (<span class="citation">(Holmes, Ward, and Wills 2013)</span> e <span class="citation">(Holmes, Ward, and Wills 2012)</span>) e <strong>KFAS</strong> (<span class="citation">(Helske 2016a)</span> e <span class="citation">(Helske 2016b)</span>).</p>
<p>Com o objetivo de apresentar os pacotes em diferentes formulações, temos uma lista selecionada e reduzida o qual mostra o tratamento diferenciado na formulação de variáveis determinísticas, constantes e variáveis de estado. A lista não difere os algoritmos usados, não difere os diferentes métodos de otimização que possivelmente podem ser usados, não difere os possiveis testes estatísticos disponibilizados nos pacotes para avaliar as estimativas, não caracteriza performance/velocidade e também não avalia precisão e estabilidade númerica. O foco é somente na formulação, o que implica na forma como o modelo deve ser representado, ou seja, como as matrizes nas equações de transição de estado e observação devem ser escritas. Uma observação, o nome das variáveis nos sitemas abaixo não são os mesmos da documentação dos pacotes e também esses nomes não representam os nomes da variáveis nas funções/scripts para a definição das equações de transição e estado. Os nomes aqui foram homegenizados para fascilitar a visualização.</p>
<ol start="7" style="list-style-type: decimal">
<li>\begin{equation}
  \text{KFAS = } \begin{cases}
y_{t} &amp;= F_{t} \alpha_{t} + \epsilon_{t}  \\
\alpha_{t + 1} &amp;= G_{t} \alpha_{t} + R_{t} \eta_{t}    
  \end{cases} \\
  \epsilon_t \sim N\lgroup 0, H_{t}\rgroup \\
  \eta_t \sim N\lgroup 0, Q_{t}\rgroup.
\end{equation}</li>
<li>\begin{equation}
  \text{sspir = dlm =  } \begin{cases}
y_{t} &amp;= F_{t} \alpha_{t} + \epsilon_{t}  \\
\alpha_{t} &amp;= G_{t} \alpha_{t - 1} + \eta_{t}    
  \end{cases} \\
  \epsilon_t \sim N\lgroup 0, H_{t}\rgroup \\
  \eta_t \sim N\lgroup 0, Q_{t}\rgroup.
\end{equation}</li>
<li>\begin{equation}
  \text{FKF = } \begin{cases}
y_{t}          &amp;= F_{t} \alpha_{t} + a_{t} + A_{\epsilon t} \epsilon_{t}  \\
\alpha_{t + 1} &amp;= G_{t} \alpha_{t - 1} + u_{t} + R_{t}\eta_{t}    
  \end{cases} \\
  \epsilon_t \sim N\lgroup 0, I_{K_\epsilon} \rgroup \\
  \eta_t \sim N\lgroup 0, I_K \rgroup.
\end{equation}</li>
<li>\begin{equation}
  \text{MARSS =  } \begin{cases}
y_{t} &amp;= F_{t} \alpha_{t} + a_t + D_t d_t + \epsilon_{t}  \\
\alpha_{t} &amp;= G_{t} \alpha_{t - 1} + u_t + C_t c_t + \eta_{t}    
  \end{cases} \\
  \epsilon_t \sim N\lgroup 0, H_{t}\rgroup \\
  \eta_t \sim N\lgroup 0, Q_{t}\rgroup.
\end{equation}</li>
</ol>
<p>Todos os modelo são multivariados com dimensão <span class="math inline">\(N\)</span> e <span class="math inline">\(M\)</span> para as séries de observação e de estado, respectivamente. A tabela (11.) mostra a dimensão de todas as variáveis, omitindo-se o indexador temporal <span class="math inline">\(t\)</span>.</p>
<ol start="11" style="list-style-type: decimal">
<li><table>
<thead>
<tr class="header">
<th align="left"><span class="math inline">\(y\)</span></th>
<th align="center"><span class="math inline">\(\alpha\)</span></th>
<th align="center"><span class="math inline">\(F\)</span></th>
<th align="left"><span class="math inline">\(G\)</span></th>
<th align="left"><span class="math inline">\(R\)</span></th>
<th align="left"><span class="math inline">\(a\)</span></th>
<th align="left"><span class="math inline">\(u\)</span></th>
<th align="left"><span class="math inline">\(c\)</span></th>
<th align="left"><span class="math inline">\(C\)</span></th>
<th align="left"><span class="math inline">\(d\)</span></th>
<th align="left"><span class="math inline">\(D\)</span></th>
<th align="left"><span class="math inline">\(H\)</span></th>
<th align="left"><span class="math inline">\(Q\)</span></th>
<th align="left"><span class="math inline">\(A_\epsilon\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(N \times 1\)</span></td>
<td align="center"><span class="math inline">\(M \times 1\)</span></td>
<td align="center"><span class="math inline">\(N \times M\)</span></td>
<td align="left"><span class="math inline">\(M \times N\)</span></td>
<td align="left"><span class="math inline">\(M \times K\)</span></td>
<td align="left"><span class="math inline">\(N \times 1\)</span></td>
<td align="left"><span class="math inline">\(M \times 1\)</span></td>
<td align="left"><span class="math inline">\(c1 \times 1\)</span></td>
<td align="left"><span class="math inline">\(M \times c1\)</span></td>
<td align="left"><span class="math inline">\(d1 \times 1\)</span></td>
<td align="left"><span class="math inline">\(N \times d1\)</span></td>
<td align="left"><span class="math inline">\(N \times N\)</span></td>
<td align="left"><span class="math inline">\(K \times K\)</span></td>
<td align="left"><span class="math inline">\(N \times K_\epsilon\)</span></td>
</tr>
</tbody>
</table></li>
</ol>
<p>Nota-se que a matriz de covariância da variáveis de estado <span class="math inline">\(\eta_{t} \sim N(0, Q_t)\)</span> tem dimensão <span class="math inline">\(K \times K\)</span> o qual pode ter um posto diferente de <span class="math inline">\(M\)</span>. O caso interessante com <span class="math inline">\(posto(Q) = K &lt; M\)</span> foi mostrado em (1.) e (4.), correspondendo ao caso de fator em comum.</p>
<p>Nas equações em que os componentes dos ruídos aleatórios <span class="math inline">\(\epsilon\)</span> e <span class="math inline">\(\eta\)</span> não são pre-multiplicados pelas matrizes <span class="math inline">\(A_\epsilon\)</span> e <span class="math inline">\(R\)</span>, respectivamente, esses componentes devem ter a dimensão da respectiva variável observacional: <span class="math inline">\(dim(\epsilon) = dim(y) = N\)</span> ou de estado <span class="math inline">\(dim(\eta) = dim(\alpha) = M\)</span>. Já no caso do modelo <strong>FKF</strong> (9.), temos <span class="math inline">\(dim(\epsilon) = K_\epsilon\)</span>. Quando a <span class="math inline">\(\eta\)</span> é pre-multiplicado por <span class="math inline">\(R\)</span>, <span class="math inline">\(dim(\eta) = K\)</span>. Desta forma fica entendindo como a dimensão das variáveis se alteram de acordo com a formulação.</p>
<p>Para ficar mais claro, o sistema do modelo <strong>KFAS</strong> em (7.) pode ser perfeitamente transformado no sistema <strong>dlm</strong> na (8.). Vejamos, em (7.), <span class="math inline">\(Var(R\eta)= RQ_{KFAS}R^{'} = \Sigma_{\eta}\)</span>, que é uma matriz <span class="math inline">\(M \times M\)</span>. Pela observação feita anteriormente, em (8.), <span class="math inline">\(Var(\eta) = Q_{dlm}\)</span>, uma matriz <span class="math inline">\(M \times M\)</span>. A equivalência é feita fazendo <span class="math inline">\(R = II\)</span>, onde <span class="math inline">\(II\)</span> é uma matriz com valores <span class="math inline">\(0\)</span> e <span class="math inline">\(1\)</span> devidamente posicionados de forma a valer a igualdade <span class="math inline">\(\Sigma_{\eta} = Q_{dlm}\)</span>. A definição do ruído aleatório na forma <span class="math inline">\(R\eta\)</span> ou diretamente como no <strong>dlm</strong> é uma questão de conveniência. Fazendo <span class="math inline">\(R\eta\)</span>, os componentes <span class="math inline">\(\eta\)</span> são mais naturalmente associados com os distúrbios do modelo em particular. Outro ponto, com implicações númericas, é que em <span class="math inline">\(R\eta\)</span> podemos manter a matriz de covariância <span class="math inline">\(K \times K\)</span> com posto completo (<span class="math inline">\(posto(Q) = K\)</span>), ao passo que na formulação direta, e equivalente, teremos uma matriz <span class="math inline">\(M \times M\)</span> com <span class="math inline">\(posto = K &lt; M\)</span>.</p>
<p>Os modelos apresentados não estão completos, faltando principalmente a definição das condições iniciais, o qual para alguns caso pode ser puramente aleatória (full diffuse).</p>
</div>
<div id="modelos-alternativos-e-nao-linear" class="section level2">
<h2>Modelos alternativos e não linear</h2>
<p>Os modelos em state space são eficientemente utilizados com a hipótese que de os ruídos aletórios tem distribuição normal ou quando as equações de transição de estado e observacional são lineares. Porém, excercícios empíricos com modelos de fator comum conforme as equações (4.) apresentam os coeficientes ímplicitos do vetor de cointegração com variação ao longo do tempo. A variação é econtrada quando considerado a estimativas em diferentes janelas de período. Essa variação destes parâmetros gera problemas em regras de trading baseadas em sinais advindos do vetor de cointegração e também é um indício de que o modelo usado tem um problema de especificação, precisando de um modelo mais geral (encompassing model).</p>
<p>A mudança de parâmetro pode ser devido: a) um erro intrínseco de especificação do modelo, b) o processeso gerador de dados (DGP - data generating process - ) foi alterado. O caso b) é dificil solução, uma vez que os dados anteriores a ruptura perdem muito conteúdo informacional para inferência estatística e previsão. De qualquer forma, um modelo mais geral e com capacidade de adptação rápita e flexivel é necessário para lidar com o problema.</p>
<p>Considerando o modelo em formato state space na sua forma geral, conforme algum dos sistemas representados pelas equações (7.), (8.), (9.) ou (10.), mesmo que as matrizes <span class="math inline">\(F_t\)</span> e <span class="math inline">\(G_t\)</span> sejam indexadas com o tempo, a variação ocorre de forma não estocástica, de forma determinada. Caso a variação nas matrizes <span class="math inline">\(F_t\)</span> ou <span class="math inline">\(G_t\)</span> sejam estócasticas e com alguma dependência com a variável observacional <span class="math inline">\(y_t\)</span> ou de estado <span class="math inline">\(\alpha_t\)</span> a linearidade é quebrada e as equações recursivas do filtro de Kalman para a estimativa do estado e previsão não são mais válidas.</p>
<p>Um modelo mais geral, pode ser escrito como <span class="citation">(Hamilton 1994)</span>:</p>
<ol start="12" style="list-style-type: decimal">
<li>\begin{equation}
   \begin{cases}
y_{t} &amp;= f \lgroup \alpha_{t} \rgroup + \epsilon_{t}  \\
\alpha_{t} &amp;= g \lgroup \alpha_{t - 1} \rgroup + \eta_{t}    
  \end{cases} \\
  \epsilon_t \sim N\lgroup 0, H_{t}\rgroup \\
  \eta_t \sim N\lgroup 0, Q_{t}\rgroup \\
  f:R^{M} \longmapsto R^{N} \\
  g:R^{M} \longmapsto R^{M}. 
\end{equation}</li>
</ol>
<p>As funções <span class="math inline">\(f\)</span> e <span class="math inline">\(g\)</span> são contínuas e conhecidas, são parâmtros do modelo. Um caso particular de interesse seria o caso de <span class="math inline">\(g\)</span> linear e <span class="math inline">\(f\)</span> multilinear.</p>
<p>Seguinda a notação de (1.), o sistema com coeficiente de cointegração variando ao longo do tempo seria:</p>
<ol start="13" style="list-style-type: decimal">
<li><span class="math display">\[ 
\begin{align}
y_t &amp;= \Theta_{t} \mu_t + \mu_{0} + \epsilon_t  &amp; \text{Var$(\epsilon_t) = \Sigma_{\epsilon}$,} &amp; \text{equação de observação} \\
\mu_t &amp;= \mu_{t-1} + \beta + \eta_{t} &amp; \text{Var$(\eta_t) = \Sigma_{\eta}$,} &amp; \text{equação de transição de estado.}
\end{align}
\]</span></li>
</ol>
<p>Neste caso, precisaríamos de uma processo <span class="math inline">\(A_t\)</span> de tal forma que a equação (3.) fosse generalisada para:</p>
<ol start="14" style="list-style-type: decimal">
<li><span class="math display">\[ A_{t} \Theta_t = 0.\]</span></li>
</ol>
<div id="montana01" class="section level4">
<h4><span class="citation">Triantafyllopoulos and Montana (2008)</span></h4>
<p>Algumas alternativas para lidar com coeficientes variando ao longo do tempo foi feita por <span class="citation">(Triantafyllopoulos and Montana 2008)</span>. O referido artigo é uma extenção de <span class="citation">(Elliott, Hoek, and Malcolm 2005)</span> e também foi aplicado em <span class="citation">(Moura, Pizzinga, and Zubelli)</span>.</p>
<p>A série observarcional nesta metodologia é o spread:</p>
<ol start="15" style="list-style-type: decimal">
<li><span class="math display">\[
y_t = \alpha + p_{t}^{i} - \beta p_{t}^{j}
\]</span></li>
</ol>
<p>onde <span class="math inline">\(p_t\)</span> é o preço de uma ação. A sugestão nos artigo inclusive é estimar <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span> por mínimos quadrados. Com a série de spread formada, usa-se a seguinte forma state-space:</p>
<ol start="16" style="list-style-type: decimal">
<li>\begin{equation}
   \begin{cases}
y_{t} &amp;= x_{t} +  w_{t}  \\
x_{t} &amp;= A_t + B_t x_{t - 1} + \epsilon_{t}    
  \end{cases} \\
\end{equation}</li>
</ol>
<p><span class="math inline">\(x_t\)</span> é a variável de estado e <span class="math inline">\(w_t\)</span> e <span class="math inline">\(\epsilon_t\)</span> são ruídos aleatórios estacionários.</p>
<p>A pesar do modelo lidar com a mudança dos parâmetros, a série observacional é artificialmente manipulado para gerar uma séries estacionária <span class="math inline">\(y_t\)</span>. O modelo não trata diretamente as séries de preço nas equações observacionais e estado. O problema de haver alteração temporal em <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span> na equação (15.) permanece, podendo apenas ser atenuado com a essa nova metodologia.</p>
<p>Desta forma, fica claro que a tendência comum estocástica do modelo de <span class="citation">(Triantafyllopoulos and Montana 2008)</span> não sendo simultaneamente estimada com os demais parâmetros possibilitou que o modelo linear ainda fosse usado.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-elliot01">
<p>Elliott, Robert J., John Van Der Hoek, and William P. Malcolm. 2005. “Pairs Trading.” <em>Quantitative Finance</em> 5 (3): 271–76. doi:<a href="https://doi.org/10.1080/14697680500149370">10.1080/14697680500149370</a>.</p>
</div>
<div id="ref-hamilton:94">
<p>Hamilton, James. 1994. “State-Space Models.” In <em>Handbook of Econometrics Volume 4</em>, edited by R. Engle and D. McFadden. North-Holland.</p>
</div>
<div id="ref-harvey:90">
<p>Harvey, Andrew C. 1989. <em>Forecasting, Structural Time Series Models and the Kalman Filter</em>. Cambridge University Press.</p>
</div>
<div id="ref-KFASarticle">
<p>Helske, Jouni. 2016a. “KFAS: Exponential Family State Space Models in R.” <em>Accepted to Journal of Statistical Software</em>.</p>
</div>
<div id="ref-KFAS">
<p>———. 2016b. <em>KFAS: Kalman Filter and Smoother for Exponential Family State Space Models</em>. <a href="http://cran.r-project.org/package=KFAS" class="uri">http://cran.r-project.org/package=KFAS</a>.</p>
</div>
<div id="ref-marss:02">
<p>Holmes, Elizabeth E., Eric J. Ward, and Kellie Wills. 2012. “MARSS: Multivariate Autoregressive State-Space Models for Analyzing Time-Series Data.” <em>The R Journal</em> 4 (1): 30.</p>
</div>
<div id="ref-marss:01">
<p>———. 2013. <em>MARSS: Multivariate Autoregressive State-Space Modeling</em>. <a href="http://cran.r-project.org/web/packages/MARSS/" class="uri">http://cran.r-project.org/web/packages/MARSS/</a>.</p>
</div>
<div id="ref-ssfpack22">
<p>Koopman, Siem Jan, Neil Shephard, and Jurgen A. Doornik. 1999. “Statistical Algorithms for Models in State Space Using SsfPack 2.2.” <em>Econometrics Journal</em> 2 (1): 113–66.</p>
</div>
<div id="ref-Helmut:05">
<p>Lutkepohl, Helmut. 2005. <em>New Introduction to Multiple Time Series Analysis</em>. Berlin: Springer-Verlag.</p>
</div>
<div id="ref-impamoura01">
<p>Moura, Carlos Eduardo de, Adrian Pizzinga, and Jorge Zubelli“A Pairs Trading Strategy Based on Linear State Space Models and the Kalman Filter.” <em>Quantitative Finance</em> 0 (0): 1–15. doi:<a href="https://doi.org/10.1080/14697688.2016.1164886">10.1080/14697688.2016.1164886</a>.</p>
</div>
<div id="ref-DLM:01">
<p>Petris, Giovanni. 2010. “An R Package for Dynamic Linear Models.” <em>Journal of Statistical Software</em> 36 (12): 1–16. <a href="http://www.jstatsoft.org/v36/i12/" class="uri">http://www.jstatsoft.org/v36/i12/</a>.</p>
</div>
<div id="ref-DLM:02">
<p>Petris, Giovanni, Sonia Petrone, and Patrizia Campagnoli. 2009. <em>Dynamic Linear Models with R</em>. UseR! Springer-Verlag, New York.</p>
</div>
<div id="ref-montana01">
<p>Triantafyllopoulos, K., and G. Montana. 2008. “Dynamic modeling of mean-reverting spreads for statistical arbitrage.” <em>ArXiv E-Prints</em>, August.</p>
</div>
<div id="ref-KFinR:11">
<p>Tusell, Fernando. 2011. “Kalman Filtering in R.” <em>Journal of Statistical Software</em>, 1–27.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
